<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles/view-page.css" />
    <title>Student Details</title>
  </head>
  <body>
    <div class="page-container">
      <div class="content-container">
        <div class="header">
          <h1>Student Details</h1>
        </div>
        <div class="content">
          <h1 class="student-name">
            <%= student.firstName %> <%= student.lastName %>
          </h1>

          <% if (success) { %>
          <p class="success"><%= success %></p>
          <% } %> <% if (error) { %>
          <p class="error"><%= error %></p>
          <% } %>

          <div class="student-info">
            <div class="info-item">
              <p>Student ID</p>
              <div class="value"><%= student.studentId %></div>
            </div>
            <div class="info-item">
              <p>Email</p>
              <div class="value"><%= student.email %></div>
            </div>
            <div class="info-item">
              <p>Department</p>
              <div class="value"><%= student.department %></div>
            </div>
            <div class="info-item">
              <p>Enrollment Date</p>
              <div class="value">
                <%= student.enrollmentDate.toLocaleDateString() %>
              </div>
            </div>
            <div class="info-item">
              <p>Status</p>
              <span
                class="status <%= student.isActive ? 'active' : 'inactive' %>"
              >
                <%= student.isActive ? 'Active' : 'Inactive' %>
              </span>
            </div>
            <div class="info-item">
              <p>GPA</p>
              <div class="value"><%= student.GPA.toFixed(2) %></div>
            </div>
            <div class="info-item">
              <p>Address</p>
              <div class="value">
                <% if (student.address) { %> <%= student.address.city || 'N/A'
                %>, <%= student.address.street || 'N/A' %> <% } else { %> No
                address provided <% } %>
              </div>
            </div>
          </div>

          <h2 class="table-title">
            Enrolled Courses (<%= student.courses.length %>)
          </h2>
          <% if (student.courses && student.courses.length > 0) { %>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Course Code</th>
                  <th>Course Title</th>
                  <th>Semester</th>
                  <th>Grade</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% student.courses.forEach(course => { %> <% if (course._id) {
                %>
                <tr>
                  <td><%= course._id.courseCode %></td>
                  <td><%= course._id.title %></td>
                  <td><%= course.semester %></td>
                  <td>
                    <% if (typeof course.grade === 'number') { %> <%=
                    course.grade %> <% } else { %> N/A <% } %>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <a
                        href="/students/<%= student.studentId %>/courses/<%= course._id._id %>/edit-grade"
                        class="btn"
                      >
                        <% if (course.grade !== undefined && course.grade !==
                        null) {%> Edit Grade <% } else { %> Add Grade <% } %>
                      </a>

                      <form
                        action="/students/<%= student.studentId %>/courses/<%= course._id._id %>/remove"
                        method="POST"
                      >
                        <button type="submit" class="btn drop-btn">Drop</button>
                      </form>
                    </div>
                  </td>
                </tr>
                <% } %> <% }); %>
              </tbody>
            </table>
          </div>
          <% } else { %>
          <p>No courses currently enrolled.</p>
          <% } %> <% if (courses && courses.length > 0) { %>

          <h2>Enroll in New Course</h2>

          <% if (enrollError && enrollError !== null) { %>
          <p class="error"><%= enrollError %></p>
          <% } %>

          <form
            action="/students/<%= student.studentId %>/courses"
            method="POST"
          >
            <div class="course-enroll-form">
              <select name="courseId" id="courseId" required>
                <% courses.forEach(course => { %>
                <option value="<%= course._id %>">
                  <%= course.courseCode %> - <%= course.title %>
                </option>
                <% }); %>
              </select>
              <input
                type="text"
                name="semester"
                id="semester"
                required
                placeholder="e.g., Fall 2025"
              />
              <button type="submit" class="btn">Enroll</button>
            </div>
          </form>
          <% } %>

          <div class="actions-bar">
            <a href="/students/<%= student.studentId %>/edit" class="btn">
              Edit Student
            </a>
            <form
              action="/students/<%= student.studentId %>?_method=DELETE"
              method="POST"
            >
              <button
                type="submit"
                class="btn delete-btn"
                onclick="return confirm('Are you sure you want to delete this student?')"
              >
                Delete Student
              </button>
            </form>
            <a href="/students" class="btn">Back to All Students</a>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
